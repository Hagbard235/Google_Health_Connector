# Google Health Connector für IP-Symcon

Dieses IP-Symcon Modul empfängt Daten von Google Health Connect und legt diese in Variablen ab. Im Konfigurationsformular kann ausgewählt werden, welche Datentypen synchronisiert werden sollen.

## 1. Funktionsweise

Google Health Connect ist eine reine **On-Device-API** für Android. Das bedeutet, dass keine Cloud-Schnittstelle existiert, auf die IP-Symcon direkt zugreifen kann.

Die Lösung besteht aus zwei Komponenten:
1.  **Dieses IP-Symcon Modul:** Es richtet einen WebHook ein, der auf Daten wartet.
2.  **Eine Companion App (nicht Teil dieses Moduls):** Eine separate Android-App, die auf dem Smartphone installiert sein muss. Diese App liest die Daten aus Health Connect aus und sendet sie an den WebHook des IP-Symcon Moduls.

## 2. Einrichtung

1.  Installiere das Modul über den Module Store in IP-Symcon.
2.  Erstelle eine neue Instanz von "Google Health Connector".
3.  Öffne die Konfiguration der Instanz. Dort wird dir die **WebHook-URL** angezeigt.
4.  Kopiere diese URL.
5.  Füge die URL in die dafür vorgesehene Einstellung der Companion App auf deinem Android-Gerät ein.
6.  Wähle in der Konfiguration der IP-Symcon Instanz aus, welche Daten du empfangen möchtest.
7.  Speichere die Konfiguration. Die entsprechenden Variablen werden automatisch angelegt oder entfernt.

## 3. Spezifikation für die Companion App

Die Companion App muss die gesammelten Daten als **HTTP POST** Request mit dem `Content-Type: application/json` an die WebHook-URL des Moduls senden.

Der Body des Requests muss ein JSON-Objekt sein. Die **Schlüssel (Keys)** dieses Objekts definieren den Datentyp (z.B. `"steps"`, `"weight"`). Der **Wert (Value)** zu jedem Schlüssel ist wiederum ein Objekt, das die eigentlichen Datenpunkte enthält.

### Beispiel-Payload (JSON)

Hier ist ein Beispiel, wie ein vollständiger JSON-Body aussehen könnte, den die Companion App sendet:

```json
{
    "steps": {
        "value": 12345
    },
    "weight": {
        "value": 80.5
    },
    "blood_pressure": {
        "systolic": 125,
        "diastolic": 82
    },
    "sleep_session": {
        "duration_total_minutes": 465,
        "duration_deep_minutes": 75,
        "duration_light_minutes": 270,
        "duration_rem_minutes": 90,
        "duration_awake_minutes": 30,
        "start_time": "2023-10-27T23:00:00Z",
        "end_time": "2023-10-28T07:15:00Z"
    }
}
```

### Unterstützte Daten-Keys

Die folgenden `keys` im JSON werden vom Modul verstanden und verarbeitet, sofern der entsprechende Haken in der Konfiguration gesetzt ist. Die Companion App sollte diese Keys verwenden.

| JSON Key (`key`) | `module.php` Property | Erwartete Daten im Value-Objekt |
|-------------------|-----------------------|-----------------------------------|
| `steps` | `EnableSteps` | `{ "value": <integer> }` |
| `distance` | `EnableDistance` | `{ "value": <float> }` (in Metern) |
| `total_calories_burned` | `EnableTotalCaloriesBurned` | `{ "value": <float> }` (in kcal) |
| `active_calories_burned` | `EnableActiveCaloriesBurned`| `{ "value": <float> }` (in kcal) |
| `weight` | `EnableWeight` | `{ "value": <float> }` (in kg) |
| `heart_rate` | `EnableHeartRate` | `{ "value": <integer> }` (bpm) |
| `resting_heart_rate` | `EnableRestingHeartRate` | `{ "value": <integer> }` (bpm) |
| `blood_pressure` | `EnableBloodPressure` | `{ "systolic": <int>, "diastolic": <int> }` |
| `body_temperature` | `EnableBodyTemperature` | `{ "value": <float> }` (°C) |
| `oxygen_saturation` | `EnableOxygenSaturation` | `{ "value": <float> }` (%) |
| `sleep_session` | `EnableSleepSession` | `{ "duration_..._minutes": <int>, "start_time": "<str>", "end_time": "<str>" }` |

> **Hinweis:** Die Namen der JSON-Keys (z.B. `blood_pressure`) werden im PHP-Code dynamisch in die entsprechenden Methodennamen (`ProcessBloodPressureData`) und Property-Namen (`EnableBloodPressure`) umgewandelt. Es ist daher wichtig, dass die Companion App genau diese Keys verwendet.
